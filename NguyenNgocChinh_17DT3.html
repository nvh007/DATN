<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Project</title>
    <!-- JQUERY LIBRARY -->
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
        integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
        crossorigin="anonymous" />
    <!-- THƯ VIỆN CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <style>
        div.fixed1 {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 1535px;
            border: 3px solid #73AD21;
        }

        table,
        th,
        td {
            border: 1px solid black;
            text-align: center;
        }

        /* body {
            margin: 0 auto;
            /* canh bố cục đều 2 bên 
            padding: 0;
            width: 1600px;
        } */

        .wrap {
            width: 1535px;
            /* kích thước chiều rộng trang web */
            float: left;
            /* canh div từ trái sang */
        }

        /* id="header" thì phải định nghĩa bằng dấu # và tên id (header) */
        #header {
            width: 1535px;
            height: 100px;
            /* kích thước chiều rộng trang web */
            float: left;
            /* canh div từ trái sang */
            background-color: rgb(10, 149, 214);
            /* tạo màu để dễ nhìn */
        }

        .main {
            width: 1535px;
            /* kích thước chiều rộng trang web */
            float: left;
            /* canh div từ trái sang */

        }

        /* chiều rộng của 2 vùng div "nav" và "content" phải bằng tổng độ rộng của trang */
        /* chú ý padding, border, margin có thể ảnh hưởng đến độ rộng của trang web */
        .nav {
            width: 535px;
            /* kích thước chiều rộng của vùng thanh bên */
            float: left;
            /* canh div từ trái sang */
            background-color: rgb(14, 204, 230);
            /* tạo màu để dễ nhìn */
            text-align: center;
        }

        .content {
            width: 1000px;
            /* kích thước chiều rộng của vùng nội dung */
            float: left;
            /* canh div từ trái sang */
            background-color: lightblue;
            /* tạo màu để dễ nhìn */
            border: 3px red;
        }

        #footer {
            width: 1535px;
            /* kích thước chiều rộng của vùng nội dung 
            float: left;
            /* canh div từ trái sang */
            background-color: rgb(10, 149, 214);
            /* tạo màu để dễ nhìn */
        }
    </style>
</head>

<body>
    <div class="wrap">
        <!-- sử dụng 1 div bao hết nội dung web lại -->
        <div id="header">
            <!-- phần header -->
            <br>
            <h1 id="text" ; style="text-align: center;font-size:300%; color:rgb(231, 21, 14);">WaterFlowMeter</h1>
        </div>

        <div class="main">
            <!-- bao phần nội dung chính -->
            <div class="nav">
                <form action="/action_page.php">
                    <label for="cars">Household:</label>
                    <select name="Hộ gia đình" id="code">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                    <input type="submit" value="Submit">
                </form>

                <iframe width="535" height="260" style="border: 1px solid #cccccc; align-items: center;"
            src="https://thingspeak.com/channels/1399967/charts/2?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=L%C6%B0u+l%C6%B0%E1%BB%A3ng+n%C6%B0%E1%BB%9Bc&type=line&xaxis=Th%E1%BB%9Di+gian&yaxis=L%C6%B0%E1%BB%A3ng+n%C6%B0%E1%BB%9Bc">
          </iframe>
                <h4 id="t" ; style="text-align: center;">Biểu đồ khối lượng nước sử dụng</h4>

                <P><br><br><br><button id="ngatnuoc" type="button" class="btn btn-danger">Ngắt nước</button></P>
            </div>

            <div class="content">
                <table id="myTable" style="width:100%">
                    <tr>
                        <th>Ngày</th>
                        <th>Tổng lượng nước sử dụng (L) </th>
                        <th>Số tiền phải thanh toán</th>
                    </tr>
                </table>
            </div>

        </div> <!-- kết thúc nội dung chính -->
        <div class="fixed1">
            <div id="footer">
                <!-- phần header -->
                Contact us: Nguyễn Ngọc Chính 0394216190 & Nguyễn Vũ Hoàng 0963200505
            </div>
        </div>


    </div> <!-- sử dụng 1 div bao hết nội dung web lại -->

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase.js"></script>

    <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
          apiKey: "AIzaSyC2K3h7dUg-lKuB6euuUtbkO-LMj9yZ6vY",
          authDomain: "testdoan-464d3.firebaseapp.com",
          databaseURL: "https://testdoan-464d3-default-rtdb.firebaseio.com",
          projectId: "testdoan-464d3",
          storageBucket: "testdoan-464d3.appspot.com",
          messagingSenderId: "795165111358",
          appId: "1:795165111358:web:7e56de59a16301d66acd6f",
          measurementId: "G-9E3SB0J54Z"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        var database = firebase.database().ref('/IoT');
        var i = 1;
        var a;
        var b;

        database.once('value').then((snapshot) => {
            b = (snapshot.val() && snapshot.val().Stop);
            while (1) {
                a = (snapshot.val() && snapshot.val().Flow[i]);
                if (a == null) break;
                console.log(a);
                    insRow('myTable');
                    i++;

            }
        });
        database.on('value', function (snapshot) {
            console.log(snapshot.val().Flow[i]);
            a = snapshot.val().Flow[i];
            if (a != null)
                {
                    insRow('myTable');
                    i++;
                }
        });

        function insRow(id) {
            var x = document.getElementById(id).insertRow(i);
            var y = x.insertCell(0);
            var z = x.insertCell(1);
            var w = x.insertCell(2);
            y.innerHTML = i;
            z.innerHTML = a;
            w.innerHTML = a * 1200;
        }  
        document.getElementById('ngatnuoc').onclick = function () {
            var element = document.getElementById("ngatnuoc");
            if(b) {
                b=0;
                writeStatus('0');
                element.classList.remove('btn-danger');
                element.classList.add('btn-success');
                element.innerText = 'Bật nước';
            }
            else {
                b=1
                writeStatus('1');
                element.classList.add('btn-danger');
                element.classList.remove('btn-success');
                element.innerText = 'Ngắt nước';
            }
        }
        var writeStatus = function(status) {
            database.update(
                 {'/Stop':status}
            )
        }           

        $(document).ready(function() {
            
        });
    </script>

</body>